<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Tetris ‚Äî Mobile</title>
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}

body{
    margin:0;
    background:#000;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    min-height:100vh;

    background-image:url("background.png");
    background-repeat:no-repeat;
    background-position:center top;
    background-size:contain;
}

#menu{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.8);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:10;
}

#menu-card{
    padding:18px 20px;
    border-radius:14px;
    border:1px solid #fff;
    background:rgba(0,0,0,.92);
    text-align:center;
    max-width:320px;
}

#menu-card h1{margin:0 0 8px;font-size:20px}
#menu-card p{margin:4px 0;font-size:13px}
#btn-start{
    margin-top:10px;
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    background:#2e7dff;
    color:#fff;
    font-size:17px;
    font-weight:bold;
}

#game{
    margin-top:12px;
    background:rgba(0,0,0,.55);
    border-radius:14px;
    padding:10px;
}

canvas{
    border-radius:6px;
    background:rgba(0,0,0,.4);
}

#info{
    text-align:center;
    margin-top:4px;
    font-size:13px;
    opacity:.9;
}
</style>
</head>

<body>

<div id="menu">
    <div id="menu-card">
        <h1>TETRIS ‚Äî MOBILE</h1>
        <p>Criado por: Luiz Carlos</p>
        <p>Luisa e Catharina üíñ</p>
        <p style="margin-top:6px;">
            Toque para girar<br>
            Arraste para mover/baixar
        </p>
        <button id="btn-start">JOGAR</button>
    </div>
</div>

<div id="game">
    <canvas id="canvas" width="320" height="480"></canvas>
    <div id="info">
        Score: <span id="score">0</span> ‚Äî Linhas: <span id="lines">0</span>
    </div>
</div>

<script>
// ----------------------
// √ÅUDIO
// ----------------------
let bgm = new Audio("musica.mp3");
bgm.loop = true;

// ----------------------
// JOGO
// ----------------------
const W = 10, H = 20, S = 24;
const cvs = document.getElementById("canvas");
const ctx = cvs.getContext("2d");
cvs.width = W*S; cvs.height = H*S;

let field = new Array(W*H).fill(0);
let pieces = [];

pieces[0]="..X...X...X...X.";
pieces[1]="..X..XX..X.......";
pieces[2]=".X..XX...X.......";
pieces[3]=".XX..XX..........";
pieces[4]="..X..XX..X.......";
pieces[5]="...X.XXX.........";
pieces[6]="X...XXX..........";

let cur,rot,x,y,next,score=0,lines=0;
let fall=500, timer=0, last=0;
let showOxe=0;

function rotIdx(px,py,r){
  switch(r%4){
    case 0:return py*4+px;
    case 1:return 12+py-(px*4);
    case 2:return 15-(py*4)-px;
    case 3:return 3-py+(px*4);
  }
}
function fit(t,r,xx,yy){
  for(let px=0;px<4;px++)
    for(let py=0;py<4;py++){
      let i=rotIdx(px,py,r);
      if(pieces[t][i]==="X"){
        let fx=xx+px, fy=yy+py;
        if(fx<0||fx>=W||fy<0||fy>=H) return false;
        if(field[fy*W+fx]) return false;
      }
    }
  return true;
}
function newGame(){
  field.fill(0); score=lines=0; fall=500;
  cur=Math.floor(Math.random()*7);
  next=Math.floor(Math.random()*7);
  rot=0; x=3; y=0; showOxe=0;
  document.getElementById("score").textContent=0;
  document.getElementById("lines").textContent=0;
}

function lockPiece(){
  for(let px=0;px<4;px++)
    for(let py=0;py<4;py++){
      if(pieces[cur][rotIdx(px,py,rot)]==="X"){
        let fx=x+px, fy=y+py;
        if(fy>=0&&fy<H) field[fy*W+fx]=cur+1;
      }
    }
  let cleared=0;
  for(let yy=0;yy<H;yy++){
    let full=true;
    for(let xx=0;xx<W;xx++)
      if(!field[yy*W+xx]){full=false;break;}
    if(full){
      cleared++;
      for(let k=yy;k>0;k--)
        for(let xx=0;xx<W;xx++)
          field[k*W+xx]=field[(k-1)*W+xx];
      for(let xx=0;xx<W;xx++) field[xx]=0;
    }
  }
  if(cleared){
    lines+=cleared;
    score+=cleared===1?100:cleared===2?300:cleared===3?500:800;
    document.getElementById("score").textContent=score;
    document.getElementById("lines").textContent=lines;
    showOxe=700;
    if(fall>120) fall-=12;
  }
  cur=next; next=Math.floor(Math.random()*7);
  rot=0; x=3; y=0;
  if(!fit(cur,rot,x,y)) gameOver=true;
}

function draw(dt){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  ctx.fillStyle="rgba(0,0,0,.45)";
  ctx.fillRect(0,0,cvs.width,cvs.height);

  for(let yy=0;yy<H;yy++)
    for(let xx=0;xx<W;xx++){
      let v=field[yy*W+xx];
      if(v){ctx.fillStyle=["#0ff","#0f0","#fa0","#ff0","#c0f","#f33","#f6c"][v%7];
        ctx.fillRect(xx*S+1,yy*S+1,S-2,S-2);}
    }

  if(!gameOver)
    for(let px=0;px<4;px++)
      for(let py=0;py<4;py++)
        if(pieces[cur][rotIdx(px,py,rot)]==="X"){
          ctx.fillStyle=["#0ff","#0f0","#fa0","#ff0","#c0f","#f33","#f6c"][ (cur+1)%7 ];
          ctx.fillRect((x+px)*S+1,(y+py)*S+1,S-2,S-2);
        }

  if(showOxe>0){
    showOxe-=dt;
    ctx.font="30px Arial";
    ctx.fillStyle="yellow";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText("Ox√™e!",cvs.width/2,cvs.height/2);
  }

  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,.6)";
    ctx.fillRect(20,180,cvs.width-40,80);
    ctx.fillStyle="#fff"; ctx.textAlign="center";
    ctx.font="20px Arial";
    ctx.fillText("GAME OVER",cvs.width/2,205);
    ctx.font="14px Arial";
    ctx.fillText("Toque em JOGAR para reiniciar",cvs.width/2,235);
  }
}

let gameOver=false;
function loop(t){
  let dt=t-last; last=t;
  if(!gameOver){
    timer+=dt;
    if(timer>=fall){
      timer=0;
      if(fit(cur,rot,x,y+1)) y++;
      else lockPiece();
    }
  }
  draw(dt);
  requestAnimationFrame(loop);
}

// ----------------------
// TOQUE / GESTOS MOBILE
// ----------------------
let sx=0, sy=0;

cvs.addEventListener("touchstart",e=>{
  let t=e.touches[0];
  sx=t.clientX; sy=t.clientY;
});

cvs.addEventListener("touchend",e=>{
  let t=e.changedTouches[0];
  let dx=t.clientX-sx, dy=t.clientY-sy;

  let adx=Math.abs(dx), ady=Math.abs(dy);

  // toque curto = girar
  if(adx<10 && ady<10){
    let r=(rot+1)%4;
    if(fit(cur,r,x,y)) rot=r;
    return;
  }

  // arrastar horizontal
  if(adx>ady){
    if(dx>15 && fit(cur,rot,x+1,y)) x++;
    if(dx<-15 && fit(cur,rot,x-1,y)) x--;
  }else{
    // arrastar para baixo
    if(dy>15 && fit(cur,rot,x,y+1)) y++;
  }
});

// ----------------------
// MENU
// ----------------------
document.getElementById("btn-start").onclick=()=>{
  document.getElementById("menu").style.display="none";
  newGame();
  gameOver=false;
  bgm.play().catch(()=>{});
};

requestAnimationFrame(loop);
</script>

</body>
</html>
